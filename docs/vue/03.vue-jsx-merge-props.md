---
title: vue-jsx-merge-props
date: 2020-10-26 14:11:39
permalink: /pages/8a2413/
categories:
  - Vue
tags:
  - vue
---
## @babel-helper-vue-jsx-merge-props

vue jsx 转换器内部使用的用于合并 props 传播的软件包。

### 内部代码现实

```JavaScript
const nestRE = /^(attrs|props|on|nativeOn|class|style|hook)$/
/**
 * 合并函数
 * @param {function} a
 * @param {function} b
 * @return {function}
 */
const mergeFn = (a, b) => {
  return function () {
    a && a.apply(this, arguments)
    b && b.apply(this, arguments)
  }
}

/**
 * 合并JSX道具
 * @param {object[]} array
 * @return {object}
 */
const mergeJSXProps = array => {
  return array.reduce((acc, cur) => {
    let accValue, curValue, key, nestedKey, temp

    for (key in cur) {
      accValue = acc[key]
      curValue = cur[key]
      if (accValue && nestRE.test(key)) {
        // 2、 判断获取accValue是否有值，且key是 attrs|props|on|nativeOn|class|style|hook 其中一个
        // normalize class
        if (key === 'class') {
          if (typeof accValue === 'string') {
            // 如果累加器的值是字符串
            // 就把累加器的值 = 对象，字符串变成对象的key，并值为true
            temp = accValue
            acc[key] = accValue = {}
            accValue[temp] = true
          }
          if (typeof curValue === 'string') {
            // 如果当前的值是字符串
            // 就把当前的值 = 对象，字符串变成对象的key，并值为true
            temp = curValue
            cur[key] = curValue = {}
            curValue[temp] = true
          }
        }
        if (key === 'on' || key === 'nativeOn' || key === 'hook') {
          // 合并函数
          for (nestedKey in curValue) {
            accValue[nestedKey] = mergeFn(accValue[nestedKey], curValue[nestedKey])
          }
        } else if (Array.isArray(accValue)) {
          acc[key] = accValue.concat(curValue)
        } else if (Array.isArray(curValue)) {
          acc[key] = [accValue].concat(curValue)
        } else {
          for (nestedKey in curValue) {
            accValue[nestedKey] = curValue[nestedKey]
          }
        }
      } else {
        // 1、 先添加到 acc里去
        acc[key] = cur[key]
      }
    }

    return acc
  }, {})
}

module.exports = mergeJSXProps
```

### test

```JavaScript
const jsxProps = [
  {
    class: 'hahah-1 jajajja-1 lalal-1',
  },
  {
    class: 'hahah-2 jajajja-2 lalal-2',
  },
  {
    on: {
      click: $event => console.log($event),
    },
  },
  {
    on: {
      click: $event => doSomething($event),
    },
  },
]

console.info(mergeJSXProps(jsxProps))
```

```
{
  class: {
    'hahah-1 jajajja-1 lalal-1': true,
    'hahah-2 jajajja-2 lalal-2': true
  },
  on: { click: [Function (anonymous)] }
}
```

### use

需要合并一些道具树，如下所示：

```JavaScript
import mergeProps from '@vue/babel-helper-vue-jsx-merge-props'

const MyComponent = {
  render(h) {
    // original: <button onClick={$event => console.log($event)} {...{ on: { click: $event => doSomething($event) } }} />
    return h(
      'button',
      mergeProps([
        {
          on: {
            click: $event => console.log($event),
          },
        },
        {
          on: {
            click: $event => doSomething($event),
          },
        },
      ]),
    )
  },
}
```
